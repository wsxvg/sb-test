<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="no-referrer">
    <title>ä¸–æ ‡äº”é‡‘å•†åŸ</title>
    <style>
        :root { --primary: #3296F0; --bg: #ffffff; --border: #eeeeee; --gray-bg: #F7F7F7; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, sans-serif; background: white; color: #333; overflow-x: hidden; }

        /* --- é¡¶éƒ¨å¤åˆ»å›¾ä¸€ --- */
        .top-nav-bar { 
            position: fixed; top: 0; width: 100%; height: 55px; background: white; 
            z-index: 1000; display: flex; align-items: center; padding: 0 10px; gap: 10px;
        }
        .orange-logo { width: 32px; height: 32px; background: #FF7033; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .orange-logo::after { content: "âˆ¨"; color: white; font-weight: bold; font-size: 14px; }
        
        .search-container { flex: 1; background: #EFEFEF; height: 36px; border-radius: 18px; display: flex; align-items: center; padding: 0 15px; color: #888; font-size: 14px; }
        .search-container i { margin-right: 8px; font-style: normal; }
        
        .scan-icon { width: 28px; height: 28px; opacity: 0.7; }

        /* é¡µé¢åˆ‡æ¢æ§åˆ¶ */
        .page { display: none; padding-top: 55px; padding-bottom: 60px; height: 100vh; }
        .page.active { display: block; }

        /* --- åˆ†ç±»é¡µæ·±åº¦å¤åˆ» --- */
        .cat-view { display: flex; height: calc(100vh - 115px); overflow: hidden; }
        
        /* å·¦ä¾§èœå• */
        .cat-left { width: 100px; background: var(--gray-bg); overflow-y: auto; flex-shrink: 0; }
        .cat-left-item { 
            padding: 18px 10px; font-size: 14px; text-align: center; color: #333; 
            border-left: 4px solid transparent; line-height: 1.4;
        }
        .cat-left-item.active { 
            background: white; color: var(--primary); 
            border-left-color: var(--primary); font-weight: bold; 
        }

        /* å³ä¾§å†…å®¹ */
        .cat-right { flex: 1; overflow-y: auto; padding: 0 15px; background: white; }
        .sub-group-title { 
            font-size: 15px; font-weight: bold; padding: 15px 0 10px; 
            position: sticky; top: 0; background: white; z-index: 10;
        }
        
        /* 3åˆ—ç½‘æ ¼å¤åˆ» */
        .sub-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px 10px; padding-bottom: 30px; }
        .sub-item { text-align: center; display: flex; flex-direction: column; align-items: center; }
        .sub-item img { width: 70px; height: 70px; object-fit: contain; margin-bottom: 8px; }
        .sub-item p { font-size: 12px; color: #333; line-height: 1.2; word-break: break-all; height: 28px; overflow: hidden; }

        /* åº•éƒ¨ TabBar */
        .tabbar { position: fixed; bottom: 0; width: 100%; height: 55px; background: white; border-top: 1px solid #ddd; display: flex; z-index: 2000; }
        .tab-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #777; }
        .tab-item img { width: 24px; height: 24px; margin-bottom: 3px; }
        .tab-item.active { color: var(--primary); }

        /* å…¶ä»–é¡µé¢æ ·å¼ */
        .placeholder { padding: 100px 20px; text-align: center; color: #999; }
    </style>
</head>
<body>

    <!-- é¡¶éƒ¨å¤åˆ» -->
    <div class="top-nav-bar" id="globalHeader">
        <div class="orange-logo"></div>
        <div class="search-container">
            <i>ğŸ”</i> æœç´¢äº§å“
        </div>
        <img src="images/home-scan.png" class="scan-icon" onerror="this.style.display='none'">
    </div>

    <!-- 1. é¦–é¡µ -->
    <div id="homePage" class="page active">
        <div id="homeContent" class="placeholder">æ­£åœ¨åŠ è½½é¦–é¡µå†…å®¹...</div>
    </div>

    <!-- 2. åˆ†ç±»é¡µ (å¤åˆ»å›¾ä¸€) -->
    <div id="categoryPage" class="page">
        <div class="cat-view">
            <div id="catLeft" class="cat-left"></div>
            <div id="catRight" class="cat-right">
                <div id="categoryDynamicArea"></div>
            </div>
        </div>
    </div>

    <!-- 3. è´­ç‰©è½¦ -->
    <div id="cartPage" class="page">
        <div class="placeholder">
            <img src="https://kaifa.sintoyu.cn/xcximages/cart-empty2.png" width="180"><br>
            è´­ç‰©è½¦ç©ºç©ºå¦‚ä¹Ÿ~~
        </div>
    </div>

    <!-- 4. æˆ‘çš„ -->
    <div id="mePage" class="page">
        <div class="placeholder">ä¸ªäººä¸­å¿ƒç•Œé¢</div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="tabbar">
        <div class="tab-item active" onclick="switchTab('home', this)">
            <img src="images/home_un.png"><span>é¦–é¡µ</span>
        </div>
        <div class="tab-item" onclick="switchTab('category', this)">
            <img src="images/category_un.png"><span>åˆ†ç±»</span>
        </div>
        <div class="tab-item" onclick="switchTab('cart', this)">
            <img src="images/cart_un.png"><span>è´­ç‰©è½¦</span>
        </div>
        <div class="tab-item" onclick="switchTab('me', this)">
            <img src="images/user_un.png"><span>æˆ‘</span>
        </div>
    </div>

    <script>
        const IMG_HOST = "https://kaifa.sintoyu.cn";
        let productsDB = null;
        let homeConfig = null;

        async function init() {
            try {
                const [resP, resH] = await Promise.all([
                    fetch('products_db.json').then(r => r.json()),
                    fetch('home_config.json').then(r => r.json())
                ]);
                productsDB = resP;
                homeConfig = resH;
                renderCategoryLeft();
            } catch (e) {
                console.error("æ•°æ®åŠ è½½å¤±è´¥", e);
            }
        }

        // --- åˆ†ç±»æ¸²æŸ“é€»è¾‘ï¼ˆå…³é”®ä¿®æ”¹ï¼‰ ---
        function renderCategoryLeft() {
            const left = document.getElementById('catLeft');
            left.innerHTML = productsDB.category_tree.map((cat, idx) => `
                <div class="cat-left-item ${idx===0?'active':''}" onclick="selectCat(${idx})">
                    ${cat.name}
                </div>
            `).join('');
            selectCat(0);
        }

        function selectCat(idx) {
            const items = document.querySelectorAll('.cat-left-item');
            items.forEach(it => it.classList.remove('active'));
            items[idx].classList.add('active');

            const cat = productsDB.category_tree[idx];
            const container = document.getElementById('categoryDynamicArea');
            
            let html = '';
            
            // æ˜“è®¢è´§çš„é€»è¾‘ï¼šå¦‚æœæœ‰äºŒçº§åˆ†ç±»(subs)ï¼Œæˆ‘ä»¬è¦æŒ‰ç»„æ˜¾ç¤º
            if (cat.subs && cat.subs.length > 0) {
                // æ¨¡æ‹Ÿå›¾ä¸€ï¼šæˆ‘ä»¬æŠŠäºŒçº§åˆ†ç±»çš„åå­—ä½œä¸ºä¸€ä¸ªå¤§æ ‡é¢˜ï¼Œä¸‹é¢åˆ—å‡ºå®ƒçš„å­ç±»ï¼ˆå¦‚æœæœ‰ï¼‰
                // å¦‚æœæ²¡æœ‰ä¸‰çº§ç±»ï¼Œå°±ç›´æ¥æ˜¾ç¤ºäºŒçº§ç±»
                html += `<div class="sub-group-title">${cat.name}</div>`;
                html += `<div class="sub-grid">`;
                
                cat.subs.forEach(sub => {
                    const imgUrl = fixImgUrl(sub.img);
                    html += `
                        <div class="sub-item" onclick="alert('ç‚¹å‡»äº†: ${sub.name}')">
                            <img src="${imgUrl}" onerror="this.src='placeholder.svg'">
                            <p>${sub.name}</p>
                        </div>`;
                });
                
                // è¡¥ä¸€ä¸ªâ€œå…¨éƒ¨â€æŒ‰é’®ï¼Œå¤åˆ»å›¾äºŒ
                html += `
                    <div class="sub-item">
                        <div style="width:70px; height:70px; background:#f0f7ff; border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--primary); font-size:24px;">âŠ</div>
                        <p>å…¨éƒ¨${cat.name}</p>
                    </div>`;
                
                html += `</div>`;
            }
            
            container.innerHTML = html;
        }

        // å›¾ç‰‡è·¯å¾„ä¿®æ­£å‡½æ•°
        function fixImgUrl(url) {
            if (!url) return 'placeholder.svg';
            if (url.startsWith('http')) return url;
            return IMG_HOST + (url.startsWith('/') ? '' : '/') + url;
        }

        function switchTab(name, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            document.getElementById(name + 'Page').classList.add('active');
            el.classList.add('active');
            
            // åªæœ‰â€œæˆ‘â€çš„é¡µé¢éšè—é¡¶éƒ¨æœç´¢æ 
            document.getElementById('globalHeader').style.display = (name === 'me') ? 'none' : 'flex';
        }

        init();
    </script>
</body>
</html>