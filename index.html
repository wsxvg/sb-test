<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="no-referrer">
    <title>ä¸–æ ‡äº”é‡‘å•†åŸ</title>
    <style>
        :root { --primary: #3296F0; --bg: #f5f5f5; --border: #eeeeee; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: #333; overflow-x: hidden; }

        /* é¡¶éƒ¨ç»Ÿä¸€æœç´¢æ¡ */
        .top-search { position: fixed; top: 0; width: 100%; height: 50px; background: white; z-index: 1000; padding: 8px 15px; border-bottom: 1px solid var(--border); }
        .search-box { background: #F2F3F5; height: 34px; border-radius: 17px; display: flex; align-items: center; padding: 0 15px; color: #999; font-size: 14px; }

        /* é¡µé¢åˆ‡æ¢æ§åˆ¶ */
        .page { display: none; padding-bottom: 60px; min-height: 100vh; }
        .page.active { display: block; }
        #homePage, #cartPage, #mePage { padding-top: 0; }
        #categoryPage { padding-top: 50px; }

        /* --- é¦–é¡µç»„ä»¶è‡ªé€‚åº”æ ·å¼ --- */
        .home-section { width: 100%; background: white; margin-bottom: 10px; overflow: hidden; }
        
        /* Type 1: å¤§è½®æ’­å›¾ */
        .row-type-1 img { width: 100%; display: block; }

        /* Type 2: å…¬å‘Šæ  */
        .row-type-2 { background: white; padding: 10px 15px; display: flex; align-items: center; font-size: 13px; }
        .row-type-2 .label { color: #E64340; font-weight: bold; border-right: 1px solid #ddd; padding-right: 10px; margin-right: 10px; flex-shrink: 0; }
        .row-type-2 marquee { flex: 1; }

        /* Type 6/7/13: åœ†å½¢å“ç‰Œå›¾æ ‡ç½‘æ ¼ (ä¸€è¡Œ5ä¸ª) */
        .row-type-brand { display: grid; grid-template-columns: repeat(5, 1fr); padding: 15px 5px; gap: 10px 0; }
        .brand-item { text-align: center; }
        .brand-item .circle { width: 55px; height: 55px; border-radius: 50%; border: 1px solid #f0f0f0; margin: 0 auto 5px; overflow: hidden; display: flex; align-items: center; justify-content: center; background: white; }
        .brand-item img { width: 100%; height: 100%; object-fit: cover; }
        .brand-item p { font-size: 11px; color: #333; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; padding: 0 2px; }

        /* --- åˆ†ç±»é¡µæ ·å¼ --- */
        .cat-view { display: flex; height: calc(100vh - 110px); background: white; overflow: hidden; }
        .cat-left { width: 90px; background: #F7F7F7; overflow-y: auto; }
        .cat-left-item { padding: 18px 5px; font-size: 13px; text-align: center; color: #666; border-left: 3px solid transparent; }
        .cat-left-item.active { background: white; color: var(--primary); border-left-color: var(--primary); font-weight: bold; }
        .cat-right { flex: 1; overflow-y: auto; padding: 10px; }
        .sub-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px 10px; }
        .sub-item { text-align: center; font-size: 11px; color: #666; }
        .sub-item img { width: 100%; aspect-ratio: 1; border-radius: 4px; background: #f9f9f9; margin-bottom: 5px; }

        /* é€šç”¨å•†å“åˆ—è¡¨æ ·å¼ */
        .product-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; padding: 10px; }
        .prod-card { background: white; border-radius: 8px; padding: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .prod-card img { width: 100%; aspect-ratio: 1; object-fit: contain; }
        .prod-name { font-size: 12px; height: 34px; margin: 5px 0; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        .prod-price { color: #ff5000; font-weight: bold; font-size: 15px; }
        .prod-info { font-size: 10px; color: #999; margin-top: 3px; }

        /* åº•éƒ¨ TabBar */
        .tabbar { position: fixed; bottom: 0; width: 100%; height: 55px; background: white; border-top: 1px solid #ddd; display: flex; z-index: 2000; }
        .tab-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #777; }
        .tab-item img { width: 24px; height: 24px; margin-bottom: 3px; }
        .tab-item.active { color: var(--primary); }

        /* è´­ç‰©è½¦å’Œæˆ‘çš„ å ä½ */
        .empty-view { padding-top: 100px; text-align: center; color: #999; background: white; min-height: 100vh; }
        .me-header { background: var(--primary); padding: 40px 20px; color: white; display: flex; align-items: center; gap: 15px; }
        .avatar { width: 60px; height: 60px; border-radius: 50%; border: 2px solid white; background: #fff; }
    </style>
</head>
<body>

    <div class="top-search" id="searchBar">
        <div class="search-box">ğŸ” æœç´¢å•†å“ç¼–ç æˆ–åç§°</div>
    </div>

    <!-- 1. é¦–é¡µ -->
    <div id="homePage" class="page active">
        <div id="homeContent"></div> <!-- åŠ¨æ€åŠ è½½å†…å®¹ -->
    </div>

    <!-- 2. åˆ†ç±»é¡µ -->
    <div id="categoryPage" class="page">
        <div class="cat-view">
            <div id="catLeft" class="cat-left"></div>
            <div id="catRight" class="cat-right">
                <div id="subGrid" class="sub-grid"></div>
                <div id="catProducts" class="product-grid" style="margin-top:20px;"></div>
            </div>
        </div>
    </div>

    <!-- 3. è´­ç‰©è½¦ (UI) -->
    <div id="cartPage" class="page">
        <div class="empty-view">
            <img src="https://kaifa.sintoyu.cn/xcximages/cart-empty2.png" width="180">
            <p>è´­ç‰©è½¦ç©ºç©ºå¦‚ä¹Ÿ~~</p>
        </div>
    </div>

    <!-- 4. æˆ‘çš„ (UI) -->
    <div id="mePage" class="page" style="padding-top: 0;">
        <div class="me-header">
            <div class="avatar"></div>
            <div>
                <div style="font-size: 18px; font-weight: bold;">17826038535</div>
                <div style="font-size: 12px; opacity: 0.8; margin-top: 4px;">æ™®é€šä¼šå‘˜</div>
            </div>
        </div>
        <div style="background:white; padding:20px; text-align:center; color:#999; margin-top:10px;">
            ä¸ªäººèµ„æ–™åŠè®¾ç½®
        </div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="tabbar">
        <div class="tab-item active" onclick="switchTab('home', this)">
            <img src="images/home_un.png" class="icon"><span>é¦–é¡µ</span>
        </div>
        <div class="tab-item" onclick="switchTab('category', this)">
            <img src="images/category_un.png" class="icon"><span>åˆ†ç±»</span>
        </div>
        <div class="tab-item" onclick="switchTab('cart', this)">
            <img src="images/cart_un.png" class="icon"><span>è´­ç‰©è½¦</span>
        </div>
        <div class="tab-item" onclick="switchTab('me', this)">
            <img src="images/user_un.png" class="icon"><span>æˆ‘</span>
        </div>
    </div>

    <script>
        const IMG_HOST = "https://kaifa.sintoyu.cn";
        let productsDB = null;
        let homeConfig = null;

        async function init() {
            // åŠ è½½ä¸¤ä¸ªæ•°æ®æº
            const [resP, resH] = await Promise.all([
                fetch('products_db.json').then(r => r.json()),
                fetch('home_config.json').then(r => r.json())
            ]);
            productsDB = resP;
            homeConfig = resH;

            renderHomePage();
            renderCategoryLeft();
        }

        // --- æ ¸å¿ƒï¼šé¦–é¡µåŠ¨æ€æ’ç‰ˆé€»è¾‘ ---
        function renderHomePage() {
            const container = document.getElementById('homeContent');
            let html = '';

            homeConfig.forEach(row => {
                if (row.type === 1) { // å¤§å›¾/è½®æ’­
                    html += `<div class="home-section row-type-1">
                        <img src="${row.data[0].local}">
                    </div>`;
                } else if (row.type === 2) { // å…¬å‘Š
                    html += `<div class="home-section row-type-2">
                        <span class="label">åº—é“ºå…¬å‘Š</span>
                        <marquee>æ¬¢è¿æ¥åˆ°ä¸–æ ‡å·¥å“æ±‡</marquee>
                    </div>`;
                } else if (row.type === 6 || row.type === 7 || row.type === 13) { // å“ç‰Œ/åˆ†ç±»å›¾æ ‡ç½‘æ ¼
                    html += `<div class="home-section row-type-brand">`;
                    row.data.forEach(item => {
                        html += `<div class="brand-item">
                            <div class="circle"><img src="${item.local}"></div>
                            <p>${item.title}</p>
                        </div>`;
                    });
                    html += `</div>`;
                }
            });

            // é¦–é¡µåº•éƒ¨éšæœºè¡¥ä¸€äº›å•†å“æ¨è
            html += `<div class="section-title" style="padding:15px; font-weight:bold;">çƒ­é—¨æ¨è</div>
                     <div class="product-grid">${productsDB.products.slice(0, 10).map(p => createCard(p)).join('')}</div>`;
            
            container.innerHTML = html;
        }

        // --- æ ¸å¿ƒï¼šåˆ†ç±»é€»è¾‘ ---
        function renderCategoryLeft() {
            const left = document.getElementById('catLeft');
            left.innerHTML = productsDB.category_tree.map((cat, idx) => `
                <div class="cat-left-item ${idx===0?'active':''}" onclick="selectCat(${idx})">
                    ${cat.name}
                </div>
            `).join('');
            selectCat(0);
        }

        function selectCat(idx) {
            const items = document.querySelectorAll('.cat-left-item');
            items.forEach(it => it.classList.remove('active'));
            items[idx].classList.add('active');

            const cat = productsDB.category_tree[idx];
            
            // æ¸²æŸ“äºŒçº§åˆ†ç±»å›¾æ ‡
            const subGrid = document.getElementById('subGrid');
            subGrid.innerHTML = cat.subs.map(sub => `
                <div class="sub-item" onclick="filterGoods(${sub.id})">
                    <img src="${sub.img ? (sub.img.startsWith('http')?sub.img : IMG_HOST+sub.img) : 'placeholder.svg'}" onerror="this.src='placeholder.svg'">
                    <p>${sub.name}</p>
                </div>
            `).join('');

            // åˆå§‹æ˜¾ç¤ºè¯¥ä¸€çº§ç±»ä¸‹çš„å‰20ä¸ªå•†å“
            const initGoods = productsDB.products.filter(p => p.gid == cat.id);
            document.getElementById('catProducts').innerHTML = initGoods.slice(0, 20).map(p => createCard(p)).join('');
        }

        function filterGoods(gid) {
            const list = productsDB.products.filter(p => p.gid == gid);
            document.getElementById('catProducts').innerHTML = list.map(p => createCard(p)).join('');
        }

        function createCard(p) {
            return `<div class="prod-card">
                <img src="${p.img.startsWith('http')?p.img : IMG_HOST+p.img}" loading="lazy" onerror="this.src='placeholder.svg'">
                <div class="prod-name">${p.name}</div>
                <div class="prod-price">Â¥${p.price}</div>
                <div class="prod-info">${p.sale_info || 'ç¼–å·:' + p.num}</div>
            </div>`;
        }

        function switchTab(name, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            document.getElementById(name + 'Page').classList.add('active');
            el.classList.add('active');
            // åªåœ¨åˆ†ç±»é¡µæ˜¾ç¤ºæœç´¢æ¡†
            document.getElementById('searchBar').style.display = (name === 'category') ? 'block' : 'none';
        }

        init();
    </script>
</body>
</html>
